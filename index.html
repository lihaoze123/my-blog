<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lusitana:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js"></script>
    <title>个人主页</title>
    <style>
      .markdown h1 {
        font-size: 1.3rem;
        font-weight: bold;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
      }
      .markdown h2 {
        font-size: 1.1rem;
        font-weight: bold;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
      }
      .markdown h3 {
        font-size: 0.9rem;
        font-weight: bold;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
      }
      .markdown p {
        margin-bottom: 0.75rem;
      }
      .markdown ul,
      .markdown ol {
        margin-left: 1.5rem;
        margin-bottom: 0.75rem;
      }
      .markdown ul {
        list-style-type: disc;
      }
      .markdown ol {
        list-style-type: decimal;
      }
      .markdown code {
        background-color: #f0f0f0;
        padding: 0.1rem 0.3rem;
        border-radius: 0.25rem;
        font-family: monospace;
      }
      .markdown pre {
        background-color: #282c34;
        padding: 1rem;
        border-radius: 0.25rem;
        overflow-x: auto;
        margin-bottom: 0.75rem;
      }
      .markdown pre code {
        background-color: transparent;
        padding: 0;
        color: #abb2bf;
      }
      .markdown blockquote {
        border-left: 4px solid #e2e8f0;
        padding-left: 1rem;
        margin-left: 0;
        margin-bottom: 0.75rem;
        color: #4a5568;
      }
      
      .dark-mode .markdown code:not(pre code) {
        background-color: #3a3a3a;
        color: #e2e2e2;
      }
      
      .dark-mode .markdown blockquote {
        border-left-color: #4a5568;
        color: #a0aec0;
      }
      
      .hljs-line-numbers {
        counter-reset: line;
        padding-left: 2em;
        position: relative;
      }
      
      .hljs-line-numbers code::before {
        counter-increment: line;
        content: counter(line);
        display: inline-block;
        width: 1.5em;
        margin-left: -2em;
        margin-right: 0.5em;
        text-align: right;
        color: #666;
        user-select: none;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div id="root"></div>
    <script type="text/babel">
      marked.setOptions({
        highlight: function (code, lang) {
          if (lang && hljs.getLanguage(lang)) {
            try {
              return hljs.highlight(code, { language: lang }).value;
            } catch (err) {}
          }
          return hljs.highlightAuto(code).value;
        },
        langPrefix: 'hljs language-',
        breaks: true,
        gfm: true
      });

      const renderer = new marked.Renderer();
      const originalParagraph = renderer.paragraph.bind(renderer);
      const originalCode = renderer.code.bind(renderer);
      
      renderer.paragraph = function (text) {
        return originalParagraph(text);
      };
      
      renderer.code = function(code, language) {
        const validLang = !!(language && hljs.getLanguage(language));
        const highlighted = validLang ? hljs.highlight(code, {language}).value : hljs.highlightAuto(code).value;
        return `<pre class="hljs-line-numbers"><code class="hljs language-${language || ''}">${highlighted}</code></pre>`;
      };

      marked.use({ renderer });

      function Markdown({ children, darkMode }) {
        const containerRef = React.useRef(null);

        React.useEffect(() => {
          if (containerRef.current) {
            containerRef.current.innerHTML = marked.parse(children);

            renderMathInElement(containerRef.current, {
              delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true },
              ],
              throwOnError: false,
            });
          }
        }, [children, darkMode]);

        return <div className={`markdown ${darkMode ? 'dark-mode' : ''}`} ref={containerRef}></div>;
      }

      function Card(props) {
        const { darkMode } = props;
        return (
          <div className={`container mx-auto my-8 p-4 ${darkMode ? 'bg-gray-700 text-gray-100' : 'bg-white'} rounded shadow-md`}>
            <h2 className={`text-xl font-bold mb-4 ${darkMode ? 'text-sky-300' : 'text-sky-700'}`}>
              {props.title}
            </h2>
            {props.children}
          </div>
        );
      }

      function Header({ darkMode, toggleDarkMode }) {
        const [menuOpen, setMenuOpen] = React.useState(false);
        
        const toggleMenu = () => {
          setMenuOpen(!menuOpen);
        };
        
        return (
          <div className={`${darkMode ? 'bg-gray-800' : 'bg-sky-700'} text-white p-4 shadow-md relative z-30`}>
            <div className="container mx-auto">
              <div className="flex justify-between items-center">
                <h1
                  className="text-2xl font-bold font-serif"
                  style={{ fontFamily: "Lusitana, serif" }}
                >
                  Li Haoze's website
                </h1>
                
                <div className="flex items-center space-x-4">
                  <button 
                    onClick={toggleDarkMode} 
                    className="p-2 rounded-full hover:bg-opacity-80 focus:outline-none"
                    aria-label="切换暗黑模式"
                  >
                    {darkMode ? (
                      <i className="fas fa-sun text-yellow-300 text-xl"></i>
                    ) : (
                      <i className="fas fa-moon text-yellow-200 text-xl"></i>
                    )}
                  </button>
                  
                  <button 
                    className="md:hidden p-2 rounded hover:bg-opacity-80 focus:outline-none"
                    onClick={toggleMenu}
                    aria-label="菜单"
                  >
                    <i className={`fas ${menuOpen ? 'fa-times' : 'fa-bars'} text-xl`}></i>
                  </button>
                  
                  <nav className="hidden md:flex space-x-6">
                    <a href="#" className="hover:underline flex items-center">
                      <i className="fas fa-home mr-1"></i> 首页
                    </a>
                    <a href="#" className="hover:underline flex items-center">
                      <i className="fas fa-user mr-1"></i> 关于我
                    </a>
                    <a href="#" className="hover:underline flex items-center">
                      <i className="fas fa-pen-nib mr-1"></i> 随笔
                    </a>
                    <a href="#" className="hover:underline flex items-center">
                      <i className="fas fa-comments mr-1"></i> 留言板
                    </a>
                  </nav>
                </div>
              </div>
              
              <div 
                className={`md:hidden transition-all duration-300 overflow-hidden ${
                  menuOpen 
                    ? 'max-h-60 opacity-100 mt-4' 
                    : 'max-h-0 opacity-0'
                }`}
              >
                <nav className="flex flex-col space-y-3 py-2">
                  <a href="#" className="hover:bg-opacity-80 hover:bg-white hover:bg-opacity-10 py-2 px-3 rounded flex items-center">
                    <i className="fas fa-home mr-2 w-5 text-center"></i> 首页
                  </a>
                  <a href="#" className="hover:bg-opacity-80 hover:bg-white hover:bg-opacity-10 py-2 px-3 rounded flex items-center">
                    <i className="fas fa-user mr-2 w-5 text-center"></i> 关于我
                  </a>
                  <a href="#" className="hover:bg-opacity-80 hover:bg-white hover:bg-opacity-10 py-2 px-3 rounded flex items-center">
                    <i className="fas fa-pen-nib mr-2 w-5 text-center"></i> 随笔
                  </a>
                  <a href="#" className="hover:bg-opacity-80 hover:bg-white hover:bg-opacity-10 py-2 px-3 rounded flex items-center">
                    <i className="fas fa-comments mr-2 w-5 text-center"></i> 留言板
                  </a>
                </nav>
              </div>
            </div>
          </div>
        );
      }

      function LazyImage({ src, alt, className, placeholderColor = "#e2e8f0" }) {
        const [isLoaded, setIsLoaded] = React.useState(false);
        const [isInView, setIsInView] = React.useState(false);
        const imgRef = React.useRef(null);
        
        React.useEffect(() => {
          const observer = new IntersectionObserver(
            ([entry]) => {
              if (entry.isIntersecting) {
                setIsInView(true);
                observer.disconnect();
              }
            },
            { threshold: 0.1 }
          );
          
          if (imgRef.current) {
            observer.observe(imgRef.current);
          }
          
          return () => {
            if (imgRef.current) {
              observer.disconnect();
            }
          };
        }, []);
        
        const handleLoad = () => {
          setIsLoaded(true);
        };
        
        return (
          <div 
            ref={imgRef}
            className={`relative ${className}`}
            style={{ 
              backgroundColor: placeholderColor,
              transition: 'opacity 0.3s ease-in-out'
            }}
          >
            {isInView && (
              <img
                src={src}
                alt={alt}
                className={`w-full h-full object-cover transition-opacity duration-300 ${
                  isLoaded ? 'opacity-100' : 'opacity-0'
                }`}
                onLoad={handleLoad}
              />
            )}
            {(!isInView || !isLoaded) && (
              <div className="absolute inset-0 flex items-center justify-center">
                <i className="fas fa-spinner fa-spin text-gray-400"></i>
              </div>
            )}
          </div>
        );
      }

      function Introduction({ darkMode }) {
        return (
          <Card title="个人简介" darkMode={darkMode}>
            <div className="flex flex-col md:flex-row">
              <div className="md:w-1/4 mb-4 md:mb-0">
                <div className="w-40 h-40 bg-gray-300 rounded-full mx-auto overflow-hidden">
                  <LazyImage
                    src="https://avatars.githubusercontent.com/u/35329574?v=4"
                    alt="头像"
                    className="w-full h-full rounded-full"
                  />
                </div>
              </div>
              <div className="md:w-3/4 md:pl-4">
                <p className="mb-2">
                  <span className="font-bold">姓名：</span>李昊泽
                </p>
                <p className="mb-2">
                  <span className="font-bold">年龄：</span>18岁
                </p>
                <p className="mb-2">
                  <span className="font-bold">职业：</span>学生
                </p>
                <p className="mb-2">
                  <span className="font-bold">爱好：</span>编程、算法
                </p>
                <p className="mb-2">
                  <span className="font-bold">个人介绍：</span>
                  我是一名热爱算法和编程的爱好者，目前在进行 XCPC
                  算法竞赛的学习，精通C++，熟悉前端技术，喜欢研究新技术，欢迎一起探索！
                </p>
              </div>
            </div>
          </Card>
        );
      }

      function Article({ darkMode }) {
        const articles = [
          {
            title: "连通性问题学习笔记",
            date: "2025-02-28",
            content: `
# 图论中的连通性问题

## 有向图的强连通分量

在解决有向图问题时，通过求解强连通分量并进行缩点，我们可以将原图转化为一个有向无环图(DAG)。这样就能利用拓扑排序的性质，将原问题转化为在 DAG 上求解的问题。

### 基本概念

1. **强连通**：在有向图中，如果两个顶点之间存在互相可达的路径，则称这两个顶点是强连通的。
2. **强连通图**：如果有向图中任意两点都是强连通的，则称该图为强连通图。
3. **强连通分量**：有向图中的极大强连通子图。

### DFS 生成树

在深度优先搜索(DFS)过程中，遍历形成的树称为DFS生成树。其中的边可以分为四类：

1. **树边**：DFS遍历时实际经过的边
2. **前向边**：从祖先指向后代的非树边
3. **返祖边**：从后代指向祖先的边
4. **横叉边**：连接不同子树中节点的边

![四种边的示意图](https://picgo-chumeng.oss-cn-beijing.aliyuncs.com/四种边的示意图.svg)

判断节点是否属于同一强连通分量有两种情况：
1. 通过一条返祖边直接到达祖先节点
2. 通过横叉边再加返祖边间接到达祖先节点

简单来说，如果从一个节点出发可以到达祖先节点，那么这个节点和祖先节点就在同一个强连通分量中。 
`,
            tags: ["算法", "图论", "强连通分量"]
          },
          {
            title: "单源最短路径算法正确性的证明",
            date: "2025-02-28",
            content: `
## Dijkstra 算法

### 证明

**循环不变式** 在算法中 $\\textbf{while}$ 语句的每次迭代开始前，对于加入 $S$ 的顶点 $u$，有 $u.d = \delta(s, u)$。其中 $\delta(s, u)$ 表示从源点 $s$ 到顶点 $u$ 的最短路径长度。

1. 初始时，$S = \\varnothing$，所以循环不变式直接成立。
2. 利用反证法证明：
    1. 假设结点 $u$ 是第一个满足 $u.d \\neq \\delta(s, u)$ 的结点，假设在 $s$ 到 $u$ 的最短路径上存在一个结点 $y \\in V-S$，它的前驱中有 $x \\in S$，由于 $x.d = \\delta(s, x)$，边 $(x, y)$ 会被松弛，所以 $y.d$ 会收敛为 $y.d = \\delta(s, y)$。
    <img src="https://cdn.jsdelivr.net/gh/lihaoze123/pic/IMG_20240820_173127.jpg" style="zoom:33%;" />
    2. 由于所有边权都是非负的，所以 $y.d = \\delta(s, y) \\le \\delta(s, u) \\le u.d$。
    3. 由于在算法的第 $5$ 行中，$u$ 是 $Q = V - S$ 中 $d$ 值最小的结点，所以 $y.d \\ge u.d$，所以 $y.d = \\delta(s, y) = \\delta (s, u) = u.d$。
    4. 这与第一步的假设矛盾，所以不存在这样的结点 $u$，所以循环不变式成立。

### C++ 实现

\`\`\`cpp
void dijkstra() {
    std::priority_queue<std::pair<int, int>, std::vector<std::pair<int, int>>, std::greater<std::pair<int, int>>> q;
    dist[1] = 0;
    q.push({0, 1});
    while (q.size()) {
        auto [distance, t] = q.top();
        q.pop();
        if (st[t]) {
            continue;
        }
        st[t] = true; 
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (distance + w[i] < dist[j]) {
                dist[j] = distance + w[i];
                q.push({dist[j], j});
            }
        }
    }
}
\`\`\`
`,
            tags: ["算法", "最短路", "Dijkstra"]
          },
        ];

        const [searchTerm, setSearchTerm] = React.useState("");
        const [selectedTag, setSelectedTag] = React.useState("");
        
        const allTags = React.useMemo(() => {
          const tags = new Set();
          articles.forEach(article => {
            if (article.tags) {
              article.tags.forEach(tag => tags.add(tag));
            }
          });
          return Array.from(tags);
        }, [articles]);
        
        const filteredArticles = React.useMemo(() => {
          return articles.filter(article => {
            const matchesSearch = searchTerm === "" || 
              article.title.toLowerCase().includes(searchTerm.toLowerCase()) || 
              article.content.toLowerCase().includes(searchTerm.toLowerCase());
              
            const matchesTag = selectedTag === "" || 
              (article.tags && article.tags.includes(selectedTag));
              
            return matchesSearch && matchesTag;
          });
        }, [articles, searchTerm, selectedTag]);
        
        const handleSearchChange = (e) => {
          setSearchTerm(e.target.value);
        };
        
        const handleTagClick = (tag) => {
          setSelectedTag(tag === selectedTag ? "" : tag);
        };

        return (
          <Card title="随笔" darkMode={darkMode}>
            <div className={`mb-6 ${darkMode ? 'bg-gray-600' : 'bg-gray-50'} p-4 rounded-lg`}>
              <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                <div className="mb-4 md:mb-0 md:flex-grow md:mr-4">
                  <label htmlFor="search" className={`block text-sm font-medium ${darkMode ? 'text-gray-200' : 'text-gray-700'} mb-1`}>
                    搜索文章
                  </label>
                  <div className="relative">
                    <input
                      type="text"
                      id="search"
                      value={searchTerm}
                      onChange={handleSearchChange}
                      className={`w-full pl-10 pr-3 py-2 border ${darkMode ? 'bg-gray-700 border-gray-500 text-white' : 'border-gray-300'} rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500`}
                      placeholder="输入关键词搜索..."
                    />
                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                      <i className="fas fa-search text-gray-400"></i>
                    </div>
                  </div>
                </div>
                <div>
                  <label className={`block text-sm font-medium ${darkMode ? 'text-gray-200' : 'text-gray-700'} mb-1`}>
                    标签筛选
                  </label>
                  <div className="flex flex-wrap gap-2">
                    {allTags.map(tag => (
                      <button
                        key={tag}
                        onClick={() => handleTagClick(tag)}
                        className={`px-3 py-1 rounded-full text-sm ${
                          selectedTag === tag
                            ? 'bg-sky-600 text-white'
                            : darkMode
                              ? 'bg-gray-700 text-gray-200 hover:bg-gray-600'
                              : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                        }`}
                      >
                        {tag}
                      </button>
                    ))}
                  </div>
                </div>
              </div>
            </div>
            
            <div className="space-y-4">
              {filteredArticles.length > 0 ? (
                filteredArticles.map((article, index) => (
                  <div key={index} className={`border-b ${darkMode ? 'border-gray-600' : ''} pb-4`}>
                    <h1 className="text-3xl font-semibold">{article.title}</h1>
                    <div className="flex items-center mt-1 mb-2">
                      <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'} mr-4`}>
                        <i className="far fa-calendar-alt mr-1"></i> {article.date}
                      </span>
                      {article.tags && article.tags.map(tag => (
                        <span 
                          key={tag} 
                          className={`text-xs mr-2 px-2 py-1 rounded-full ${
                            darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-700'
                          }`}
                        >
                          {tag}
                        </span>
                      ))}
                    </div>
                    <Markdown darkMode={darkMode}>{article.content}</Markdown>
                    <a href="#" className={`${darkMode ? 'text-sky-300' : 'text-sky-600'} hover:underline`}>
                      阅读更多
                    </a>
                  </div>
                ))
              ) : (
                <div className="text-center py-8">
                  <i className={`fas fa-search text-4xl ${darkMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}></i>
                  <p className={`${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>没有找到匹配的文章</p>
                </div>
              )}
            </div>
          </Card>
        );
      }

      function MessageBoard({ darkMode }) {
        const [messages, setMessages] = React.useState([
          {
            name: "李四",
            content: "博客内容很棒，继续加油！",
            time: "2025-02-28",
          },
          {
            name: "王五",
            content: "期待更多技术文章分享~",
            time: "2025-02-28",
          },
        ]);
        
        const [newMessage, setNewMessage] = React.useState({
          name: "",
          content: ""
        });
        
        const handleInputChange = (e) => {
          const { name, value } = e.target;
          setNewMessage(prev => ({
            ...prev,
            [name]: value
          }));
        };
        
        const handleSubmit = (e) => {
          e.preventDefault();
          if (!newMessage.name || !newMessage.content) {
            alert("请填写姓名和留言内容！");
            return;
          }
          
          const today = new Date();
          const formattedDate = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
          
          setMessages([
            ...messages,
            {
              name: newMessage.name,
              content: newMessage.content,
              time: formattedDate
            }
          ]);
          
          setNewMessage({
            name: "",
            content: ""
          });
        };

        return (
          <Card title="留言板" darkMode={darkMode}>
            <div className="space-y-4">
              {messages.map((msg, index) => (
                <div key={index} className={`border-b ${darkMode ? 'border-gray-600' : ''} pb-4`}>
                  <div className="flex justify-between">
                    <span className="font-semibold">{msg.name}</span>
                    <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>{msg.time}</span>
                  </div>
                  <p className="mt-2">{msg.content}</p>
                </div>
              ))}
            </div>
            
            <div className={`mt-6 ${darkMode ? 'bg-gray-600' : 'bg-gray-50'} p-4 rounded-lg`}>
              <h3 className="text-lg font-medium mb-3">发表留言</h3>
              <form onSubmit={handleSubmit}>
                <div className="mb-3">
                  <label htmlFor="name" className={`block text-sm font-medium ${darkMode ? 'text-gray-200' : 'text-gray-700'} mb-1`}>
                    您的姓名
                  </label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    value={newMessage.name}
                    onChange={handleInputChange}
                    className={`w-full px-3 py-2 border ${darkMode ? 'bg-gray-700 border-gray-500 text-white' : 'border-gray-300'} rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500`}
                    placeholder="请输入您的姓名"
                  />
                </div>
                <div className="mb-3">
                  <label htmlFor="content" className={`block text-sm font-medium ${darkMode ? 'text-gray-200' : 'text-gray-700'} mb-1`}>
                    留言内容
                  </label>
                  <textarea
                    id="content"
                    name="content"
                    value={newMessage.content}
                    onChange={handleInputChange}
                    rows="4"
                    className={`w-full px-3 py-2 border ${darkMode ? 'bg-gray-700 border-gray-500 text-white' : 'border-gray-300'} rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500`}
                    placeholder="请输入您的留言内容"
                  ></textarea>
                </div>
                <button
                  type="submit"
                  className="px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500"
                >
                  提交留言
                </button>
              </form>
            </div>
          </Card>
        );
      }

      function Footer({ darkMode }) {
        return (
          <div className={`${darkMode ? 'bg-gray-900' : 'bg-gray-800'} text-white p-4 mt-8`}>
            <div className="container mx-auto text-center">
              <p>© 2025 李昊泽的个人博客. 保留所有权利.</p>
              <p className="mt-2">
                <i className="fas fa-envelope mr-2"></i>联系方式:
                2595248810@qq.com
              </p>
              <div className="mt-2 flex justify-center space-x-4">
                <a href="#" className="hover:text-blue-300">
                  <i className="fab fa-github mr-1"></i>GitHub
                </a>
                <a href="#" className="hover:text-blue-300">
                  <i className="fab fa-telegram mr-1"></i>Telegram
                </a>
              </div>
            </div>
          </div>
        );
      }

      function BackToTop({ darkMode }) {
        const [isVisible, setIsVisible] = React.useState(false);
        
        const toggleVisibility = () => {
          if (window.pageYOffset > 300) {
            setIsVisible(true);
          } else {
            setIsVisible(false);
          }
        };
        
        const scrollToTop = () => {
          window.scrollTo({
            top: 0,
            behavior: "smooth"
          });
        };
        
        React.useEffect(() => {
          window.addEventListener("scroll", toggleVisibility);
          return () => window.removeEventListener("scroll", toggleVisibility);
        }, []);
        
        return (
          <div 
            className={`fixed bottom-6 right-6 z-50 transition-opacity duration-300 ${
              isVisible ? 'opacity-100' : 'opacity-0 pointer-events-none'
            }`}
          >
            <button
              onClick={scrollToTop}
              className={`w-12 h-12 rounded-full shadow-lg flex items-center justify-center ${
                darkMode 
                  ? 'bg-gray-700 text-white hover:bg-gray-600' 
                  : 'bg-white text-sky-700 hover:bg-gray-100'
              }`}
              aria-label="回到顶部"
            >
              <i className="fas fa-arrow-up"></i>
            </button>
          </div>
        );
      }

      function ReadingProgressBar({ darkMode }) {
        const [readingProgress, setReadingProgress] = React.useState(0);
        
        const scrollListener = () => {
          const totalHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
          const scrollPosition = window.scrollY;
          
          if (totalHeight > 0) {
            setReadingProgress((scrollPosition / totalHeight) * 100);
          }
        };
        
        React.useEffect(() => {
          window.addEventListener("scroll", scrollListener);
          return () => window.removeEventListener("scroll", scrollListener);
        }, []);
        
        return (
          <div className="fixed top-0 left-0 w-full h-1 z-50">
            <div 
              className={`h-full ${darkMode ? 'bg-sky-400' : 'bg-sky-600'}`}
              style={{ width: `${readingProgress}%` }}
            ></div>
          </div>
        );
      }

      function Page() {
        const [darkMode, setDarkMode] = React.useState(false);
        
        const toggleDarkMode = () => {
          setDarkMode(!darkMode);
        };
        
        React.useEffect(() => {
          const savedDarkMode = localStorage.getItem('darkMode');
          if (savedDarkMode !== null) {
            setDarkMode(JSON.parse(savedDarkMode));
          } else {
            const prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
            setDarkMode(prefersDarkMode);
          }
        }, []);
        
        React.useEffect(() => {
          localStorage.setItem('darkMode', JSON.stringify(darkMode));
          
          if (darkMode) {
            document.body.classList.add('dark-mode');
            document.body.classList.add('bg-gray-900');
            document.body.classList.remove('bg-gray-100');
          } else {
            document.body.classList.remove('dark-mode');
            document.body.classList.remove('bg-gray-900');
            document.body.classList.add('bg-gray-100');
          }
        }, [darkMode]);

        return (
          <div className={`min-h-screen flex flex-col ${darkMode ? 'text-gray-100' : ''}`}>
            <ReadingProgressBar darkMode={darkMode} />
            <Header darkMode={darkMode} toggleDarkMode={toggleDarkMode} />
            <div className="flex-grow">
              <Introduction darkMode={darkMode} />
              <Article darkMode={darkMode} />
              <MessageBoard darkMode={darkMode} />
            </div>
            <Footer darkMode={darkMode} />
            <BackToTop darkMode={darkMode} />
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<Page />);
    </script>
  </body>
</html>
