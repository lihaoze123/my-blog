<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="李昊泽的个人博客，分享算法、编程和技术文章"
    />
    <meta name="keywords" content="博客,算法,编程,技术,李昊泽" />
    <meta name="author" content="李昊泽" />

    <!-- 预连接常用域名，减少DNS查询时间 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
    <link rel="preconnect" href="https://unpkg.com" crossorigin />
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />

    <!-- 预加载关键资源 -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Lusitana:wght@400;700&display=swap"
      as="style"
    />
    <link
      rel="preload"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      as="style"
    />

    <!-- 字体加载 -->
    <link
      href="https://fonts.googleapis.com/css2?family=Lusitana:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <!-- 核心样式和脚本 -->
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 延迟加载非关键资源 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- 直接加载 Markdown 解析器，确保它立即可用 -->
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>

    <!-- 按需加载 -->
    <script>
      // 延迟加载非关键脚本
      function loadScript(src, callback) {
        const script = document.createElement("script");
        script.src = src;
        script.onload = callback;
        document.head.appendChild(script);
      }

      // 页面加载完成后再加载非关键资源
      window.addEventListener("load", function () {
        // 数学公式渲染
        loadScript(
          "https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js",
          function () {
            loadScript(
              "https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"
            );
          }
        );

        // 延迟加载代码高亮
        loadScript(
          "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js",
          function () {
            loadScript(
              "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js"
            );
            loadScript(
              "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js"
            );
            loadScript(
              "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js"
            );
          }
        );
      });
    </script>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css"
    />

    <title>李昊泽的个人博客</title>
    <style>
      /* 关键CSS内联，减少渲染阻塞 */
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        line-height: 1.5;
      }

      /* 添加内容骨架屏样式 */
      .skeleton {
        animation: skeleton-loading 1s linear infinite alternate;
      }

      @keyframes skeleton-loading {
        0% {
          background-color: rgba(200, 200, 200, 0.1);
        }
        100% {
          background-color: rgba(200, 200, 200, 0.3);
        }
      }

      /* 其他样式保持不变 */
      .markdown h1 {
        font-size: 1.3rem;
        font-weight: bold;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
      }
      .markdown h2 {
        font-size: 1.1rem;
        font-weight: bold;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
      }
      .markdown h3 {
        font-size: 0.9rem;
        font-weight: bold;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
      }
      .markdown p {
        margin-bottom: 0.75rem;
      }
      .markdown ul,
      .markdown ol {
        margin-left: 1.5rem;
        margin-bottom: 0.75rem;
      }
      .markdown ul {
        list-style-type: disc;
      }
      .markdown ol {
        list-style-type: decimal;
      }
      .markdown code {
        background-color: #f0f0f0;
        padding: 0.1rem 0.3rem;
        border-radius: 0.25rem;
        font-family: monospace;
      }
      .markdown pre {
        background-color: #282c34;
        padding: 1rem;
        border-radius: 0.25rem;
        overflow-x: auto;
        margin-bottom: 0.75rem;
      }
      .markdown pre code {
        background-color: transparent;
        padding: 0;
        color: #abb2bf;
      }
      .markdown blockquote {
        border-left: 4px solid #e2e8f0;
        padding-left: 1rem;
        margin-left: 0;
        margin-bottom: 0.75rem;
        color: #4a5568;
      }

      .dark-mode .markdown code:not(pre code) {
        background-color: #3a3a3a;
        color: #e2e2e2;
      }

      .dark-mode .markdown blockquote {
        border-left-color: #4a5568;
        color: #a0aec0;
      }

      .hljs-line-numbers {
        counter-reset: line;
        padding-left: 2em;
        position: relative;
      }

      .hljs-line-numbers code::before {
        counter-increment: line;
        content: counter(line);
        display: inline-block;
        width: 1.5em;
        margin-left: -2em;
        margin-right: 0.5em;
        text-align: right;
        color: #666;
        user-select: none;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div id="root">
      <!-- 添加骨架屏，提升感知性能 -->
      <div class="min-h-screen bg-gray-100">
        <div class="bg-sky-700 text-white p-4 shadow-md">
          <div class="container mx-auto">
            <div class="h-8 w-48 skeleton rounded mb-4"></div>
            <div class="flex space-x-4">
              <div class="h-6 w-16 skeleton rounded"></div>
              <div class="h-6 w-16 skeleton rounded"></div>
              <div class="h-6 w-16 skeleton rounded"></div>
            </div>
          </div>
        </div>
        <div class="container mx-auto my-8 p-4 bg-white rounded shadow-md">
          <div class="h-8 w-32 skeleton rounded mb-6"></div>
          <div class="flex flex-col md:flex-row">
            <div class="md:w-1/4 mb-4 md:mb-0">
              <div class="w-40 h-40 skeleton rounded-full mx-auto"></div>
            </div>
            <div class="md:w-3/4 md:pl-4 space-y-4">
              <div class="h-6 w-full skeleton rounded"></div>
              <div class="h-6 w-full skeleton rounded"></div>
              <div class="h-6 w-full skeleton rounded"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="text/babel">
      // 代码分割和懒加载
      function lazyInitialize(fn) {
        let initialized = false;
        let result;

        return function () {
          if (!initialized) {
            initialized = true;
            result = fn();
          }
          return result;
        };
      }

      // 懒加载 marked 初始化
      const initMarked = lazyInitialize(() => {
        // 初始化 marked 配置
        marked.setOptions({
          highlight: function (code, lang) {
            if (typeof hljs !== "undefined" && lang && hljs.getLanguage(lang)) {
              try {
                return hljs.highlight(code, { language: lang }).value;
              } catch (err) {}
            }
            return code;
          },
          langPrefix: "hljs language-",
          breaks: true,
          gfm: true,
        });

        const renderer = new marked.Renderer();
        const originalParagraph = renderer.paragraph.bind(renderer);
        const originalCode = renderer.code.bind(renderer);

        renderer.paragraph = function (text) {
          return originalParagraph(text);
        };

        renderer.code = function (code, language) {
          if (typeof hljs !== "undefined") {
            const validLang = !!(language && hljs.getLanguage(language));
            const highlighted = validLang
              ? hljs.highlight(code, { language }).value
              : hljs.highlightAuto(code).value;
            return `<pre class="hljs-line-numbers"><code class="hljs language-${
              language || ""
            }">${highlighted}</code></pre>`;
          }
          return `<pre class="hljs-line-numbers"><code class="hljs language-${
            language || ""
          }">${code}</code></pre>`;
        };

        renderer.heading = function (text, level) {
          const id = text
            .toLowerCase()
            .replace(/[^\w\s-]/g, "")
            .replace(/\s+/g, "-");
          return `<h${level} id="${id}">${text}</h${level}>`;
        };

        marked.use({ renderer });
      });

      function TableOfContents({ content, darkMode }) {
        const [headings, setHeadings] = React.useState([]);
        const [isOpen, setIsOpen] = React.useState(true);
        const tocRef = React.useRef(null);

        React.useEffect(() => {
          // 解析Markdown内容中的标题
          const headingRegex = /^(#{1,3})\s+(.+)$/gm;
          const matches = [];
          let match;

          while ((match = headingRegex.exec(content)) !== null) {
            const level = match[1].length;
            const text = match[2].trim();
            const id = text
              .toLowerCase()
              .replace(/[^\w\s-]/g, "")
              .replace(/\s+/g, "-");

            matches.push({
              level,
              text,
              id,
            });
          }

          setHeadings(matches);
        }, [content]);

        const scrollToHeading = (id) => {
          const element = document.getElementById(id);
          if (element) {
            element.scrollIntoView({ behavior: "smooth" });
          }
        };

        if (headings.length === 0) {
          return null;
        }

        return (
          <div
            ref={tocRef}
            className={`mb-6 ${
              darkMode ? "bg-gray-800" : "bg-gray-50"
            } rounded-lg overflow-hidden`}
          >
            <div
              className={`p-3 ${
                darkMode ? "bg-gray-700" : "bg-gray-200"
              } flex justify-between items-center cursor-pointer`}
              onClick={() => setIsOpen(!isOpen)}
            >
              <h3 className="font-medium flex items-center">
                <i className="fas fa-list-ul mr-2"></i> 目录
              </h3>
              <i
                className={`fas ${
                  isOpen ? "fa-chevron-up" : "fa-chevron-down"
                }`}
              ></i>
            </div>

            <div
              className={`transition-all duration-300 ${
                isOpen ? "max-h-96 p-3" : "max-h-0 p-0"
              } overflow-y-auto`}
            >
              <ul className="space-y-1">
                {headings.map((heading, index) => (
                  <li
                    key={index}
                    className={`${
                      heading.level === 1
                        ? ""
                        : heading.level === 2
                        ? "ml-4"
                        : "ml-8"
                    }`}
                  >
                    <a
                      href={`#${heading.id}`}
                      onClick={(e) => {
                        e.preventDefault();
                        scrollToHeading(heading.id);
                      }}
                      className={`block py-1 px-2 rounded hover:bg-opacity-50 ${
                        darkMode
                          ? "hover:bg-gray-700 text-gray-300"
                          : "hover:bg-gray-200 text-gray-700"
                      }`}
                    >
                      {heading.text}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        );
      }

      function Markdown({ children, darkMode }) {
        const containerRef = React.useRef(null);

        React.useEffect(() => {
          if (containerRef.current) {
            // 确保 marked 已初始化
            initMarked();

            try {
              // 直接使用 marked 解析 Markdown
              containerRef.current.innerHTML = marked.parse(children);

              // 如果 KaTeX 已加载，渲染数学公式
              if (typeof renderMathInElement !== "undefined") {
                renderMathInElement(containerRef.current, {
                  delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "$", right: "$", display: false },
                    { left: "\\(", right: "\\)", display: false },
                    { left: "\\[", right: "\\]", display: true },
                  ],
                  throwOnError: false,
                });
              }
            } catch (error) {
              console.error("Markdown 渲染错误:", error);
              // 如果解析失败，显示纯文本
              containerRef.current.innerText = children;
            }
          }
        }, [children, darkMode]);

        return (
          <div
            className={`markdown ${darkMode ? "dark-mode" : ""}`}
            ref={containerRef}
          ></div>
        );
      }

      function Card(props) {
        const { darkMode } = props;
        return (
          <div
            className={`container mx-auto my-8 p-4 ${
              darkMode ? "bg-gray-700 text-gray-100" : "bg-white"
            } rounded shadow-md`}
          >
            <h2
              className={`text-xl font-bold mb-4 ${
                darkMode ? "text-sky-300" : "text-sky-700"
              }`}
            >
              {props.title}
            </h2>
            {props.children}
          </div>
        );
      }

      function Header({ darkMode, toggleDarkMode }) {
        const [menuOpen, setMenuOpen] = React.useState(false);

        const toggleMenu = () => {
          setMenuOpen(!menuOpen);
        };

        return (
          <div
            className={`${
              darkMode ? "bg-gray-800" : "bg-sky-700"
            } text-white p-4 shadow-md relative z-30`}
          >
            <div className="container mx-auto">
              <div className="flex justify-between items-center">
                <h1
                  className="text-2xl font-bold font-serif"
                  style={{ fontFamily: "Lusitana, serif" }}
                >
                  Li Haoze's website
                </h1>

                <div className="flex items-center space-x-4">
                  <button
                    onClick={toggleDarkMode}
                    className="p-2 rounded-full hover:bg-opacity-80 focus:outline-none"
                    aria-label="切换暗黑模式"
                  >
                    {darkMode ? (
                      <i className="fas fa-sun text-yellow-300 text-xl"></i>
                    ) : (
                      <i className="fas fa-moon text-yellow-200 text-xl"></i>
                    )}
                  </button>

                  <button
                    className="md:hidden p-2 rounded hover:bg-opacity-80 focus:outline-none"
                    onClick={toggleMenu}
                    aria-label="菜单"
                  >
                    <i
                      className={`fas ${
                        menuOpen ? "fa-times" : "fa-bars"
                      } text-xl`}
                    ></i>
                  </button>

                  <nav className="hidden md:flex space-x-6">
                    <a href="#" className="hover:underline flex items-center">
                      <i className="fas fa-home mr-1"></i> 首页
                    </a>
                    <a href="#" className="hover:underline flex items-center">
                      <i className="fas fa-user mr-1"></i> 关于我
                    </a>
                    <a href="#" className="hover:underline flex items-center">
                      <i className="fas fa-pen-nib mr-1"></i> 随笔
                    </a>
                    <a href="#" className="hover:underline flex items-center">
                      <i className="fas fa-comments mr-1"></i> 留言板
                    </a>
                  </nav>
                </div>
              </div>

              <div
                className={`md:hidden transition-all duration-300 overflow-hidden ${
                  menuOpen ? "max-h-60 opacity-100 mt-4" : "max-h-0 opacity-0"
                }`}
              >
                <nav className="flex flex-col space-y-3 py-2">
                  <a
                    href="#"
                    className="hover:bg-opacity-80 hover:bg-white hover:bg-opacity-10 py-2 px-3 rounded flex items-center"
                  >
                    <i className="fas fa-home mr-2 w-5 text-center"></i> 首页
                  </a>
                  <a
                    href="#"
                    className="hover:bg-opacity-80 hover:bg-white hover:bg-opacity-10 py-2 px-3 rounded flex items-center"
                  >
                    <i className="fas fa-user mr-2 w-5 text-center"></i> 关于我
                  </a>
                  <a
                    href="#"
                    className="hover:bg-opacity-80 hover:bg-white hover:bg-opacity-10 py-2 px-3 rounded flex items-center"
                  >
                    <i className="fas fa-pen-nib mr-2 w-5 text-center"></i> 随笔
                  </a>
                  <a
                    href="#"
                    className="hover:bg-opacity-80 hover:bg-white hover:bg-opacity-10 py-2 px-3 rounded flex items-center"
                  >
                    <i className="fas fa-comments mr-2 w-5 text-center"></i>{" "}
                    留言板
                  </a>
                </nav>
              </div>
            </div>
          </div>
        );
      }

      function LazyImage({
        src,
        alt,
        className,
        placeholderColor = "#e2e8f0",
      }) {
        const [isLoaded, setIsLoaded] = React.useState(false);
        const [isInView, setIsInView] = React.useState(false);
        const imgRef = React.useRef(null);

        React.useEffect(() => {
          const observer = new IntersectionObserver(
            ([entry]) => {
              if (entry.isIntersecting) {
                setIsInView(true);
                observer.disconnect();
              }
            },
            { threshold: 0.1 }
          );

          if (imgRef.current) {
            observer.observe(imgRef.current);
          }

          return () => {
            if (imgRef.current) {
              observer.disconnect();
            }
          };
        }, []);

        const handleLoad = () => {
          setIsLoaded(true);
        };

        return (
          <div
            ref={imgRef}
            className={`relative ${className}`}
            style={{
              backgroundColor: placeholderColor,
              transition: "opacity 0.3s ease-in-out",
            }}
          >
            {isInView && (
              <img
                src={src}
                alt={alt}
                className={`w-full h-full object-cover transition-opacity duration-300 ${
                  isLoaded ? "opacity-100" : "opacity-0"
                }`}
                onLoad={handleLoad}
              />
            )}
            {(!isInView || !isLoaded) && (
              <div className="absolute inset-0 flex items-center justify-center">
                <i className="fas fa-spinner fa-spin text-gray-400"></i>
              </div>
            )}
          </div>
        );
      }

      function Introduction({ darkMode }) {
        return (
          <Card title="个人简介" darkMode={darkMode}>
            <div className="flex flex-col md:flex-row">
              <div className="md:w-1/4 mb-4 md:mb-0">
                <div className="w-40 h-40 bg-gray-300 rounded-full mx-auto overflow-hidden">
                  <LazyImage
                    src="https://avatars.githubusercontent.com/u/35329574?v=4"
                    alt="头像"
                    className="w-full h-full rounded-full"
                  />
                </div>
              </div>
              <div className="md:w-3/4 md:pl-4">
                <p className="mb-2">
                  <span className="font-bold">姓名：</span>李昊泽
                </p>
                <p className="mb-2">
                  <span className="font-bold">年龄：</span>18岁
                </p>
                <p className="mb-2">
                  <span className="font-bold">职业：</span>学生
                </p>
                <p className="mb-2">
                  <span className="font-bold">爱好：</span>编程、算法
                </p>
                <p className="mb-2">
                  <span className="font-bold">个人介绍：</span>
                  我是一名热爱算法和编程的爱好者，目前在进行 XCPC
                  算法竞赛的学习，精通C++，熟悉前端技术，喜欢研究新技术，欢迎一起探索！
                </p>
              </div>
            </div>
          </Card>
        );
      }

      function ShareButtons({ title, darkMode }) {
        const encodedTitle = encodeURIComponent(title);
        const encodedUrl = encodeURIComponent(window.location.href);

        return (
          <div className="flex items-center mt-4 space-x-3">
            <span
              className={`text-sm ${
                darkMode ? "text-gray-400" : "text-gray-600"
              }`}
            >
              分享到：
            </span>
            <a
              href={`https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`}
              target="_blank"
              rel="noopener noreferrer"
              className={`p-2 rounded-full ${
                darkMode ? "hover:bg-gray-700" : "hover:bg-gray-200"
              }`}
              aria-label="分享到Twitter"
            >
              <i className="fab fa-twitter text-blue-400"></i>
            </a>
            <a
              href={`https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`}
              target="_blank"
              rel="noopener noreferrer"
              className={`p-2 rounded-full ${
                darkMode ? "hover:bg-gray-700" : "hover:bg-gray-200"
              }`}
              aria-label="分享到Facebook"
            >
              <i className="fab fa-facebook text-blue-600"></i>
            </a>
            <a
              href={`https://service.weibo.com/share/share.php?url=${encodedUrl}&title=${encodedTitle}`}
              target="_blank"
              rel="noopener noreferrer"
              className={`p-2 rounded-full ${
                darkMode ? "hover:bg-gray-700" : "hover:bg-gray-200"
              }`}
              aria-label="分享到微博"
            >
              <i className="fab fa-weibo text-red-500"></i>
            </a>
            <button
              onClick={() => {
                navigator.clipboard.writeText(window.location.href);
                alert("链接已复制到剪贴板！");
              }}
              className={`p-2 rounded-full ${
                darkMode ? "hover:bg-gray-700" : "hover:bg-gray-200"
              }`}
              aria-label="复制链接"
            >
              <i
                className={`fas fa-link ${
                  darkMode ? "text-gray-300" : "text-gray-600"
                }`}
              ></i>
            </button>
          </div>
        );
      }

      function CommentSection({ articleId, darkMode }) {
        const [comments, setComments] = React.useState([
          {
            id: 1,
            articleId: 1,
            author: "张三",
            content: "这篇文章讲解得非常清晰，谢谢分享！",
            date: "2025-03-01",
            likes: 5,
          },
          {
            id: 2,
            articleId: 1,
            author: "李四",
            content: "我对强连通分量的理解更深入了，期待更多图论相关的文章。",
            date: "2025-03-02",
            likes: 3,
          },
          {
            id: 3,
            articleId: 2,
            author: "王五",
            content: "Dijkstra算法的证明写得很严谨，对我帮助很大。",
            date: "2025-03-01",
            likes: 4,
          },
        ]);

        const [newComment, setNewComment] = React.useState({
          author: "",
          content: "",
        });

        const [showComments, setShowComments] = React.useState(false);

        const filteredComments = comments.filter(
          (comment) => comment.articleId === articleId
        );

        const handleInputChange = (e) => {
          const { name, value } = e.target;
          setNewComment((prev) => ({
            ...prev,
            [name]: value,
          }));
        };

        const handleSubmit = (e) => {
          e.preventDefault();
          if (!newComment.author || !newComment.content) {
            alert("请填写姓名和评论内容！");
            return;
          }

          const today = new Date();
          const formattedDate = `${today.getFullYear()}-${String(
            today.getMonth() + 1
          ).padStart(2, "0")}-${String(today.getDate()).padStart(2, "0")}`;

          const newCommentObj = {
            id: comments.length + 1,
            articleId,
            author: newComment.author,
            content: newComment.content,
            date: formattedDate,
            likes: 0,
          };

          setComments([...comments, newCommentObj]);
          setNewComment({
            author: "",
            content: "",
          });
        };

        const handleLike = (commentId) => {
          setComments(
            comments.map((comment) =>
              comment.id === commentId
                ? { ...comment, likes: comment.likes + 1 }
                : comment
            )
          );
        };

        return (
          <div className="mt-8">
            <button
              onClick={() => setShowComments(!showComments)}
              className={`flex items-center ${
                darkMode ? "text-sky-300" : "text-sky-600"
              } font-medium mb-4`}
            >
              <i
                className={`fas ${
                  showComments ? "fa-chevron-down" : "fa-chevron-right"
                } mr-2`}
              ></i>
              评论 ({filteredComments.length})
            </button>

            {showComments && (
              <>
                <div
                  className={`space-y-4 mb-6 ${
                    filteredComments.length > 0 ? "border-b" : ""
                  } ${darkMode ? "border-gray-600" : "border-gray-200"} pb-6`}
                >
                  {filteredComments.length > 0 ? (
                    filteredComments.map((comment) => (
                      <div
                        key={comment.id}
                        className={`p-4 rounded-lg ${
                          darkMode ? "bg-gray-800" : "bg-gray-50"
                        }`}
                      >
                        <div className="flex justify-between items-start">
                          <div>
                            <span className="font-medium">
                              {comment.author}
                            </span>
                            <span
                              className={`text-xs ml-2 ${
                                darkMode ? "text-gray-400" : "text-gray-500"
                              }`}
                            >
                              {comment.date}
                            </span>
                          </div>
                          <button
                            onClick={() => handleLike(comment.id)}
                            className={`flex items-center text-sm ${
                              darkMode
                                ? "text-gray-400 hover:text-gray-300"
                                : "text-gray-500 hover:text-gray-700"
                            }`}
                          >
                            <i className="far fa-thumbs-up mr-1"></i>{" "}
                            {comment.likes}
                          </button>
                        </div>
                        <p className="mt-2">{comment.content}</p>
                      </div>
                    ))
                  ) : (
                    <p
                      className={`text-center py-4 ${
                        darkMode ? "text-gray-400" : "text-gray-500"
                      }`}
                    >
                      暂无评论，来发表第一条评论吧！
                    </p>
                  )}
                </div>

                <form
                  onSubmit={handleSubmit}
                  className={`p-4 rounded-lg ${
                    darkMode ? "bg-gray-800" : "bg-gray-50"
                  }`}
                >
                  <h3 className="text-lg font-medium mb-3">发表评论</h3>
                  <div className="mb-3">
                    <label
                      htmlFor="comment-author"
                      className={`block text-sm font-medium ${
                        darkMode ? "text-gray-300" : "text-gray-700"
                      } mb-1`}
                    >
                      您的姓名
                    </label>
                    <input
                      type="text"
                      id="comment-author"
                      name="author"
                      value={newComment.author}
                      onChange={handleInputChange}
                      className={`w-full px-3 py-2 border ${
                        darkMode
                          ? "bg-gray-700 border-gray-600 text-white"
                          : "border-gray-300"
                      } rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500`}
                      placeholder="请输入您的姓名"
                    />
                  </div>
                  <div className="mb-3">
                    <label
                      htmlFor="comment-content"
                      className={`block text-sm font-medium ${
                        darkMode ? "text-gray-300" : "text-gray-700"
                      } mb-1`}
                    >
                      评论内容
                    </label>
                    <textarea
                      id="comment-content"
                      name="content"
                      value={newComment.content}
                      onChange={handleInputChange}
                      rows="3"
                      className={`w-full px-3 py-2 border ${
                        darkMode
                          ? "bg-gray-700 border-gray-600 text-white"
                          : "border-gray-300"
                      } rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500`}
                      placeholder="请输入您的评论"
                    ></textarea>
                  </div>
                  <button
                    type="submit"
                    className="px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500"
                  >
                    提交评论
                  </button>
                </form>
              </>
            )}
          </div>
        );
      }

      function ReadingTime({ content }) {
        const [readingTime, setReadingTime] = React.useState(0);

        React.useEffect(() => {
          // 计算阅读时间（假设平均阅读速度为每分钟200个汉字或400个英文单词）
          const text = content.replace(/\s+/g, " ").trim();
          const wordCount = text.split(/\s+/).length;
          const chineseCharCount = (text.match(/[\u4e00-\u9fa5]/g) || [])
            .length;

          // 英文单词按照每分钟400个计算，汉字按照每分钟200个计算
          const readingTimeMinutes = Math.ceil(
            wordCount / 400 + chineseCharCount / 200
          );

          setReadingTime(readingTimeMinutes);
        }, [content]);

        return (
          <span className="flex items-center">
            <i className="far fa-clock mr-1"></i> 阅读时间: {readingTime} 分钟
          </span>
        );
      }

      function PrintButton({ article, darkMode }) {
        const handlePrint = () => {
          // 创建一个新窗口用于打印
          const printWindow = window.open("", "_blank");

          // 构建打印页面的HTML
          const printContent = `
            <!DOCTYPE html>
            <html>
              <head>
                <meta charset="UTF-8">
                <title>${article.title} - 打印版</title>
                <style>
                  body {
                    font-family: Arial, sans-serif;
                    line-height: 1.6;
                    color: #333;
                    max-width: 800px;
                    margin: 0 auto;
                    padding: 20px;
                  }
                  h1 {
                    font-size: 24px;
                    margin-bottom: 10px;
                  }
                  .meta {
                    font-size: 14px;
                    color: #666;
                    margin-bottom: 20px;
                    border-bottom: 1px solid #eee;
                    padding-bottom: 10px;
                  }
                  .content {
                    font-size: 16px;
                  }
                  .content h1 {
                    font-size: 20px;
                    margin-top: 20px;
                  }
                  .content h2 {
                    font-size: 18px;
                  }
                  .content h3 {
                    font-size: 16px;
                  }
                  .content img {
                    max-width: 100%;
                  }
                  .content pre {
                    background-color: #f5f5f5;
                    padding: 10px;
                    border-radius: 5px;
                    overflow-x: auto;
                  }
                  .content code {
                    font-family: monospace;
                  }
                  .footer {
                    margin-top: 30px;
                    font-size: 12px;
                    color: #999;
                    text-align: center;
                    border-top: 1px solid #eee;
                    padding-top: 10px;
                  }
                  @media print {
                    body {
                      padding: 0;
                    }
                    .no-print {
                      display: none;
                    }
                  }
                </style>
              </head>
              <body>
                <div class="no-print" style="text-align: right; margin-bottom: 20px;">
                  <button onclick="window.print()">打印</button>
                  <button onclick="window.close()">关闭</button>
                </div>
                
                <h1>${article.title}</h1>
                <div class="meta">
                  <div>发布日期: ${article.date}</div>
                  <div>标签: ${
                    article.tags ? article.tags.join(", ") : "无"
                  }</div>
                </div>
                
                <div class="content">
                  ${marked.parse(article.content)}
                </div>
                
                <div class="footer">
                  © 2025 李昊泽的个人博客 | 本文永久链接: ${
                    window.location.href
                  }
                </div>
              </body>
            </html>
          `;

          // 写入内容并打印
          printWindow.document.open();
          printWindow.document.write(printContent);
          printWindow.document.close();

          // 等待资源加载完成后打印
          printWindow.onload = function () {
            setTimeout(() => {
              printWindow.focus();
              printWindow.print();
            }, 500);
          };
        };

        return (
          <button
            onClick={handlePrint}
            className={`flex items-center ${
              darkMode
                ? "text-gray-300 hover:text-white"
                : "text-gray-600 hover:text-gray-900"
            }`}
            title="打印文章"
          >
            <i className="fas fa-print mr-1"></i> 打印
          </button>
        );
      }

      function ArticleArchive({ articles, darkMode }) {
        const [isOpen, setIsOpen] = React.useState(false);

        // 按年月归档文章
        const archiveByDate = React.useMemo(() => {
          const archive = {};

          articles.forEach((article) => {
            const date = new Date(article.date);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;

            if (!archive[year]) {
              archive[year] = {};
            }

            if (!archive[year][month]) {
              archive[year][month] = [];
            }

            archive[year][month].push(article);
          });

          // 转换为排序后的数组
          return Object.keys(archive)
            .sort((a, b) => b - a) // 年份降序
            .map((year) => ({
              year: parseInt(year),
              months: Object.keys(archive[year])
                .sort((a, b) => b - a) // 月份降序
                .map((month) => ({
                  month: parseInt(month),
                  articles: archive[year][month],
                })),
            }));
        }, [articles]);

        const getMonthName = (month) => {
          const monthNames = [
            "一月",
            "二月",
            "三月",
            "四月",
            "五月",
            "六月",
            "七月",
            "八月",
            "九月",
            "十月",
            "十一月",
            "十二月",
          ];
          return monthNames[month - 1];
        };

        return (
          <div
            className={`mb-6 ${
              darkMode ? "bg-gray-800" : "bg-gray-50"
            } rounded-lg overflow-hidden`}
          >
            <div
              className={`p-3 ${
                darkMode ? "bg-gray-700" : "bg-gray-200"
              } flex justify-between items-center cursor-pointer`}
              onClick={() => setIsOpen(!isOpen)}
            >
              <h3 className="font-medium flex items-center">
                <i className="fas fa-archive mr-2"></i> 文章归档
              </h3>
              <i
                className={`fas ${
                  isOpen ? "fa-chevron-up" : "fa-chevron-down"
                }`}
              ></i>
            </div>

            <div
              className={`transition-all duration-300 ${
                isOpen ? "max-h-96 p-3" : "max-h-0 p-0"
              } overflow-y-auto`}
            >
              {archiveByDate.length > 0 ? (
                <div className="space-y-4">
                  {archiveByDate.map((yearData) => (
                    <div key={yearData.year} className="mb-2">
                      <h4
                        className={`font-medium ${
                          darkMode ? "text-gray-200" : "text-gray-700"
                        }`}
                      >
                        {yearData.year}年
                      </h4>
                      <div className="ml-4 mt-1 space-y-2">
                        {yearData.months.map((monthData) => (
                          <div key={`${yearData.year}-${monthData.month}`}>
                            <h5
                              className={`text-sm font-medium ${
                                darkMode ? "text-gray-300" : "text-gray-600"
                              }`}
                            >
                              {getMonthName(monthData.month)}
                            </h5>
                            <ul className="ml-4 space-y-1 mt-1">
                              {monthData.articles.map((article, index) => (
                                <li key={index}>
                                  <a
                                    href="#"
                                    className={`text-sm ${
                                      darkMode
                                        ? "text-sky-300 hover:text-sky-200"
                                        : "text-sky-600 hover:text-sky-800"
                                    }`}
                                    onClick={(e) => {
                                      e.preventDefault();
                                      // 这里可以添加跳转到文章的逻辑
                                      document
                                        .getElementById(`article-${index}`)
                                        .scrollIntoView({ behavior: "smooth" });
                                    }}
                                  >
                                    {article.title}
                                  </a>
                                </li>
                              ))}
                            </ul>
                          </div>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                <p
                  className={`text-center py-4 ${
                    darkMode ? "text-gray-400" : "text-gray-500"
                  }`}
                >
                  暂无文章
                </p>
              )}
            </div>
          </div>
        );
      }

      function Article({ darkMode }) {
        const articles = [
          {
            title: "连通性问题学习笔记",
            date: "2025-02-28",
            content: `
# 图论中的连通性问题

## 有向图的强连通分量

在解决有向图问题时，通过求解强连通分量并进行缩点，我们可以将原图转化为一个有向无环图(DAG)。这样就能利用拓扑排序的性质，将原问题转化为在 DAG 上求解的问题。

### 基本概念

1. **强连通**：在有向图中，如果两个顶点之间存在互相可达的路径，则称这两个顶点是强连通的。
2. **强连通图**：如果有向图中任意两点都是强连通的，则称该图为强连通图。
3. **强连通分量**：有向图中的极大强连通子图。

### DFS 生成树

在深度优先搜索(DFS)过程中，遍历形成的树称为DFS生成树。其中的边可以分为四类：

1. **树边**：DFS遍历时实际经过的边
2. **前向边**：从祖先指向后代的非树边
3. **返祖边**：从后代指向祖先的边
4. **横叉边**：连接不同子树中节点的边

![四种边的示意图](https://picgo-chumeng.oss-cn-beijing.aliyuncs.com/四种边的示意图.svg)

判断节点是否属于同一强连通分量有两种情况：
1. 通过一条返祖边直接到达祖先节点
2. 通过横叉边再加返祖边间接到达祖先节点

简单来说，如果从一个节点出发可以到达祖先节点，那么这个节点和祖先节点就在同一个强连通分量中。 
`,
            tags: ["算法", "图论", "强连通分量"],
          },
          {
            title: "单源最短路径算法正确性的证明",
            date: "2025-02-28",
            content: `
## Dijkstra 算法

### 证明

**循环不变式** 在算法中 $\\textbf{while}$ 语句的每次迭代开始前，对于加入 $S$ 的顶点 $u$，有 $u.d = \delta(s, u)$。其中 $\delta(s, u)$ 表示从源点 $s$ 到顶点 $u$ 的最短路径长度。

1. 初始时，$S = \\varnothing$，所以循环不变式直接成立。
2. 利用反证法证明：
    1. 假设结点 $u$ 是第一个满足 $u.d \\neq \\delta(s, u)$ 的结点，假设在 $s$ 到 $u$ 的最短路径上存在一个结点 $y \\in V-S$，它的前驱中有 $x \\in S$，由于 $x.d = \\delta(s, x)$，边 $(x, y)$ 会被松弛，所以 $y.d$ 会收敛为 $y.d = \\delta(s, y)$。
    <img src="https://cdn.jsdelivr.net/gh/lihaoze123/pic/IMG_20240820_173127.jpg" style="zoom:33%;" />
    2. 由于所有边权都是非负的，所以 $y.d = \\delta(s, y) \\le \\delta(s, u) \\le u.d$。
    3. 由于在算法的第 $5$ 行中，$u$ 是 $Q = V - S$ 中 $d$ 值最小的结点，所以 $y.d \\ge u.d$，所以 $y.d = \\delta(s, y) = \\delta (s, u) = u.d$。
    4. 这与第一步的假设矛盾，所以不存在这样的结点 $u$，所以循环不变式成立。

### C++ 实现

\`\`\`cpp
void dijkstra() {
    std::priority_queue<std::pair<int, int>, std::vector<std::pair<int, int>>, std::greater<std::pair<int, int>>> q;
    dist[1] = 0;
    q.push({0, 1});
    while (q.size()) {
        auto [distance, t] = q.top();
        q.pop();
        if (st[t]) {
            continue;
        }
        st[t] = true; 
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (distance + w[i] < dist[j]) {
                dist[j] = distance + w[i];
                q.push({dist[j], j});
            }
        }
    }
}
\`\`\`
`,
            tags: ["算法", "最短路", "Dijkstra"],
          },
        ];

        const [searchTerm, setSearchTerm] = React.useState("");
        const [selectedTag, setSelectedTag] = React.useState("");

        const allTags = React.useMemo(() => {
          const tags = new Set();
          articles.forEach((article) => {
            if (article.tags) {
              article.tags.forEach((tag) => tags.add(tag));
            }
          });
          return Array.from(tags);
        }, [articles]);

        const filteredArticles = React.useMemo(() => {
          return articles.filter((article) => {
            const matchesSearch =
              searchTerm === "" ||
              article.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
              article.content.toLowerCase().includes(searchTerm.toLowerCase());

            const matchesTag =
              selectedTag === "" ||
              (article.tags && article.tags.includes(selectedTag));

            return matchesSearch && matchesTag;
          });
        }, [articles, searchTerm, selectedTag]);

        const handleSearchChange = (e) => {
          setSearchTerm(e.target.value);
        };

        const handleTagClick = (tag) => {
          setSelectedTag(tag === selectedTag ? "" : tag);
        };

        return (
          <Card title="随笔" darkMode={darkMode}>
            <div className="mb-6">
              <ArticleArchive articles={articles} darkMode={darkMode} />
            </div>

            <div
              className={`mb-6 ${
                darkMode ? "bg-gray-600" : "bg-gray-50"
              } p-4 rounded-lg`}
            >
              <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                <div className="mb-4 md:mb-0 md:flex-grow md:mr-4">
                  <label
                    htmlFor="search"
                    className={`block text-sm font-medium ${
                      darkMode ? "text-gray-200" : "text-gray-700"
                    } mb-1`}
                  >
                    搜索文章
                  </label>
                  <div className="relative">
                    <input
                      type="text"
                      id="search"
                      value={searchTerm}
                      onChange={handleSearchChange}
                      className={`w-full pl-10 pr-3 py-2 border ${
                        darkMode
                          ? "bg-gray-700 border-gray-500 text-white"
                          : "border-gray-300"
                      } rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500`}
                      placeholder="输入关键词搜索..."
                    />
                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                      <i className="fas fa-search text-gray-400"></i>
                    </div>
                  </div>
                </div>
                <div>
                  <label
                    className={`block text-sm font-medium ${
                      darkMode ? "text-gray-200" : "text-gray-700"
                    } mb-1`}
                  >
                    标签筛选
                  </label>
                  <div className="flex flex-wrap gap-2">
                    {allTags.map((tag) => (
                      <button
                        key={tag}
                        onClick={() => handleTagClick(tag)}
                        className={`px-3 py-1 rounded-full text-sm ${
                          selectedTag === tag
                            ? "bg-sky-600 text-white"
                            : darkMode
                            ? "bg-gray-700 text-gray-200 hover:bg-gray-600"
                            : "bg-gray-200 text-gray-700 hover:bg-gray-300"
                        }`}
                      >
                        {tag}
                      </button>
                    ))}
                  </div>
                </div>
              </div>
            </div>

            <div className="space-y-4">
              {filteredArticles.length > 0 ? (
                filteredArticles.map((article, index) => (
                  <div
                    id={`article-${index}`}
                    key={index}
                    className={`border-b ${
                      darkMode ? "border-gray-600" : ""
                    } pb-4`}
                  >
                    <h1 className="text-3xl font-semibold">{article.title}</h1>
                    <div className="flex flex-wrap items-center mt-1 mb-2 gap-x-4 gap-y-2">
                      <span
                        className={`text-sm ${
                          darkMode ? "text-gray-400" : "text-gray-500"
                        }`}
                      >
                        <i className="far fa-calendar-alt mr-1"></i>{" "}
                        {article.date}
                      </span>
                      <span
                        className={`text-sm ${
                          darkMode ? "text-gray-400" : "text-gray-500"
                        }`}
                      >
                        <ReadingTime content={article.content} />
                      </span>
                      {article.tags &&
                        article.tags.map((tag) => (
                          <span
                            key={tag}
                            className={`text-xs px-2 py-1 rounded-full ${
                              darkMode
                                ? "bg-gray-700 text-gray-300"
                                : "bg-gray-200 text-gray-700"
                            }`}
                          >
                            {tag}
                          </span>
                        ))}
                    </div>

                    <div className="flex justify-end mb-4">
                      <PrintButton article={article} darkMode={darkMode} />
                    </div>

                    <TableOfContents
                      content={article.content}
                      darkMode={darkMode}
                    />

                    <Markdown darkMode={darkMode}>{article.content}</Markdown>
                    <div className="flex flex-wrap justify-between items-center mt-4">
                      <a
                        href="#"
                        className={`${
                          darkMode ? "text-sky-300" : "text-sky-600"
                        } hover:underline`}
                      >
                        阅读更多
                      </a>
                      <ShareButtons title={article.title} darkMode={darkMode} />
                    </div>

                    <CommentSection articleId={index + 1} darkMode={darkMode} />
                  </div>
                ))
              ) : (
                <div className="text-center py-8">
                  <i
                    className={`fas fa-search text-4xl ${
                      darkMode ? "text-gray-500" : "text-gray-400"
                    } mb-3`}
                  ></i>
                  <p
                    className={`${
                      darkMode ? "text-gray-400" : "text-gray-600"
                    }`}
                  >
                    没有找到匹配的文章
                  </p>
                </div>
              )}
            </div>
          </Card>
        );
      }

      function MessageBoard({ darkMode }) {
        const [messages, setMessages] = React.useState([
          {
            name: "李四",
            content: "博客内容很棒，继续加油！",
            time: "2025-02-28",
          },
          {
            name: "王五",
            content: "期待更多技术文章分享~",
            time: "2025-02-28",
          },
        ]);

        const [newMessage, setNewMessage] = React.useState({
          name: "",
          content: "",
        });

        const handleInputChange = (e) => {
          const { name, value } = e.target;
          setNewMessage((prev) => ({
            ...prev,
            [name]: value,
          }));
        };

        const handleSubmit = (e) => {
          e.preventDefault();
          if (!newMessage.name || !newMessage.content) {
            alert("请填写姓名和留言内容！");
            return;
          }

          const today = new Date();
          const formattedDate = `${today.getFullYear()}-${String(
            today.getMonth() + 1
          ).padStart(2, "0")}-${String(today.getDate()).padStart(2, "0")}`;

          setMessages([
            ...messages,
            {
              name: newMessage.name,
              content: newMessage.content,
              time: formattedDate,
            },
          ]);

          setNewMessage({
            name: "",
            content: "",
          });
        };

        return (
          <Card title="留言板" darkMode={darkMode}>
            <div className="space-y-4">
              {messages.map((msg, index) => (
                <div
                  key={index}
                  className={`border-b ${
                    darkMode ? "border-gray-600" : ""
                  } pb-4`}
                >
                  <div className="flex justify-between">
                    <span className="font-semibold">{msg.name}</span>
                    <span
                      className={`text-sm ${
                        darkMode ? "text-gray-400" : "text-gray-500"
                      }`}
                    >
                      {msg.time}
                    </span>
                  </div>
                  <p className="mt-2">{msg.content}</p>
                </div>
              ))}
            </div>

            <div
              className={`mt-6 ${
                darkMode ? "bg-gray-600" : "bg-gray-50"
              } p-4 rounded-lg`}
            >
              <h3 className="text-lg font-medium mb-3">发表留言</h3>
              <form onSubmit={handleSubmit}>
                <div className="mb-3">
                  <label
                    htmlFor="name"
                    className={`block text-sm font-medium ${
                      darkMode ? "text-gray-200" : "text-gray-700"
                    } mb-1`}
                  >
                    您的姓名
                  </label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    value={newMessage.name}
                    onChange={handleInputChange}
                    className={`w-full px-3 py-2 border ${
                      darkMode
                        ? "bg-gray-700 border-gray-500 text-white"
                        : "border-gray-300"
                    } rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500`}
                    placeholder="请输入您的姓名"
                  />
                </div>
                <div className="mb-3">
                  <label
                    htmlFor="content"
                    className={`block text-sm font-medium ${
                      darkMode ? "text-gray-200" : "text-gray-700"
                    } mb-1`}
                  >
                    留言内容
                  </label>
                  <textarea
                    id="content"
                    name="content"
                    value={newMessage.content}
                    onChange={handleInputChange}
                    rows="4"
                    className={`w-full px-3 py-2 border ${
                      darkMode
                        ? "bg-gray-700 border-gray-500 text-white"
                        : "border-gray-300"
                    } rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500`}
                    placeholder="请输入您的留言内容"
                  ></textarea>
                </div>
                <button
                  type="submit"
                  className="px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500"
                >
                  提交留言
                </button>
              </form>
            </div>
          </Card>
        );
      }

      function VisitorCounter({ darkMode }) {
        const [visitorCount, setVisitorCount] = React.useState(0);
        const [todayVisitors, setTodayVisitors] = React.useState(0);

        React.useEffect(() => {
          // 在实际应用中，这里应该从服务器获取真实的访问数据
          // 这里仅作为演示，使用本地存储模拟
          const storedCount = localStorage.getItem("totalVisitors");
          const lastVisit = localStorage.getItem("lastVisit");
          const today = new Date().toDateString();

          // 初始化总访问量
          let count = storedCount ? parseInt(storedCount, 10) : 0;

          // 检查是否是今天第一次访问
          if (lastVisit !== today) {
            count += 1;
            localStorage.setItem("totalVisitors", count.toString());
            localStorage.setItem("lastVisit", today);

            // 更新今日访问量
            const todayCount = localStorage.getItem("todayVisitors") || "0";
            const newTodayCount = parseInt(todayCount, 10) + 1;
            localStorage.setItem("todayVisitors", newTodayCount.toString());
            setTodayVisitors(newTodayCount);
          } else {
            // 如果今天已经访问过，只读取今日访问量
            const todayCount = localStorage.getItem("todayVisitors") || "0";
            setTodayVisitors(parseInt(todayCount, 10));
          }

          setVisitorCount(count);
        }, []);

        return (
          <div
            className={`flex items-center space-x-4 ${
              darkMode ? "text-gray-300" : "text-gray-600"
            }`}
          >
            <div className="flex items-center">
              <i className="fas fa-chart-line mr-2"></i>
              <span>总访问量: {visitorCount.toLocaleString()}</span>
            </div>
            <div className="flex items-center">
              <i className="fas fa-user-clock mr-2"></i>
              <span>今日访问: {todayVisitors.toLocaleString()}</span>
            </div>
          </div>
        );
      }

      function Footer({ darkMode }) {
        return (
          <div
            className={`${
              darkMode ? "bg-gray-900" : "bg-gray-800"
            } text-white p-4 mt-8`}
          >
            <div className="container mx-auto">
              <div className="flex flex-col md:flex-row md:justify-between md:items-center">
                <div className="mb-4 md:mb-0">
                  <p>© 2025 李昊泽的个人博客. 保留所有权利.</p>
                  <p className="mt-2">
                    <i className="fas fa-envelope mr-2"></i>联系方式:
                    2595248810@qq.com
                  </p>
                </div>

                <VisitorCounter darkMode={darkMode} />
              </div>

              <div className="mt-4 flex justify-center space-x-4">
                <a href="#" className="hover:text-blue-300">
                  <i className="fab fa-github mr-1"></i>GitHub
                </a>
                <a href="#" className="hover:text-blue-300">
                  <i className="fab fa-telegram mr-1"></i>Telegram
                </a>
              </div>
            </div>
          </div>
        );
      }

      function BackToTop({ darkMode }) {
        const [isVisible, setIsVisible] = React.useState(false);

        const toggleVisibility = () => {
          if (window.pageYOffset > 300) {
            setIsVisible(true);
          } else {
            setIsVisible(false);
          }
        };

        const scrollToTop = () => {
          window.scrollTo({
            top: 0,
            behavior: "smooth",
          });
        };

        React.useEffect(() => {
          window.addEventListener("scroll", toggleVisibility);
          return () => window.removeEventListener("scroll", toggleVisibility);
        }, []);

        return (
          <div
            className={`fixed bottom-6 right-6 z-50 transition-opacity duration-300 ${
              isVisible ? "opacity-100" : "opacity-0 pointer-events-none"
            }`}
          >
            <button
              onClick={scrollToTop}
              className={`w-12 h-12 rounded-full shadow-lg flex items-center justify-center ${
                darkMode
                  ? "bg-gray-700 text-white hover:bg-gray-600"
                  : "bg-white text-sky-700 hover:bg-gray-100"
              }`}
              aria-label="回到顶部"
            >
              <i className="fas fa-arrow-up"></i>
            </button>
          </div>
        );
      }

      function ReadingProgressBar({ darkMode }) {
        const [readingProgress, setReadingProgress] = React.useState(0);

        const scrollListener = () => {
          const totalHeight =
            document.documentElement.scrollHeight -
            document.documentElement.clientHeight;
          const scrollPosition = window.scrollY;

          if (totalHeight > 0) {
            setReadingProgress((scrollPosition / totalHeight) * 100);
          }
        };

        React.useEffect(() => {
          window.addEventListener("scroll", scrollListener);
          return () => window.removeEventListener("scroll", scrollListener);
        }, []);

        return (
          <div className="fixed top-0 left-0 w-full h-1 z-50">
            <div
              className={`h-full ${darkMode ? "bg-sky-400" : "bg-sky-600"}`}
              style={{ width: `${readingProgress}%` }}
            ></div>
          </div>
        );
      }

      // 添加性能监控
      function usePerformanceMonitor() {
        React.useEffect(() => {
          // 监控页面加载性能
          window.addEventListener("load", () => {
            setTimeout(() => {
              if (window.performance) {
                const perfData = window.performance.timing;
                const pageLoadTime =
                  perfData.loadEventEnd - perfData.navigationStart;
                console.log(`页面加载时间: ${pageLoadTime}ms`);

                // 在实际应用中，这里可以将性能数据发送到分析服务
              }
            }, 0);
          });

          // 监控组件渲染性能
          if (typeof window.__REACT_DEVTOOLS_GLOBAL_HOOK__ !== "undefined") {
            console.log("React DevTools 可用，可以使用 Profiler 监控组件性能");
          }
        }, []);
      }

      function Page() {
        const [darkMode, setDarkMode] = React.useState(false);

        // 使用性能监控
        usePerformanceMonitor();

        const toggleDarkMode = () => {
          setDarkMode(!darkMode);
        };

        React.useEffect(() => {
          const savedDarkMode = localStorage.getItem("darkMode");
          if (savedDarkMode !== null) {
            setDarkMode(JSON.parse(savedDarkMode));
          } else {
            const prefersDarkMode = window.matchMedia(
              "(prefers-color-scheme: dark)"
            ).matches;
            setDarkMode(prefersDarkMode);
          }
        }, []);

        React.useEffect(() => {
          localStorage.setItem("darkMode", JSON.stringify(darkMode));

          if (darkMode) {
            document.body.classList.add("dark-mode");
            document.body.classList.add("bg-gray-900");
            document.body.classList.remove("bg-gray-100");
          } else {
            document.body.classList.remove("dark-mode");
            document.body.classList.remove("bg-gray-900");
            document.body.classList.add("bg-gray-100");
          }
        }, [darkMode]);

        return (
          <div
            className={`min-h-screen flex flex-col ${
              darkMode ? "text-gray-100" : ""
            }`}
          >
            <ReadingProgressBar darkMode={darkMode} />
            <Header darkMode={darkMode} toggleDarkMode={toggleDarkMode} />
            <div className="flex-grow">
              <Introduction darkMode={darkMode} />
              <Article darkMode={darkMode} />
              <MessageBoard darkMode={darkMode} />
            </div>
            <Footer darkMode={darkMode} />
            <BackToTop darkMode={darkMode} />
          </div>
        );
      }

      // 使用 React 18 的并发渲染特性
      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(
        <React.StrictMode>
          <Page />
        </React.StrictMode>
      );
    </script>
  </body>
</html>
